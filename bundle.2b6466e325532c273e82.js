(()=>{"use strict";var t="";const e=t+"assets/2dbd01ce16c0fa83cb67.png";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function r(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var o=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=null,this.goblinEl=null,this.index=null,this._clickedDuring=!1,this.onCellClick=e},(n=[{key:"render",value:function(t){var n=this;this.el=document.createElement("div"),this.el.classList.add("cell"),this.goblinEl=document.createElement("img"),this.goblinEl.src=e,this.goblinEl.classList.add("goblin","hidden"),this.goblinEl.alt="goblin",this.goblinEl.draggable=!1,this.el.append(this.goblinEl),t.append(this.el),this.index=Array.from(t.children).indexOf(this.el),this.el.addEventListener("click",function(){n.hasGoblin()&&(n._clickedDuring=!0,n.onCellClick&&n.onCellClick(n.index,!0))})}},{key:"showGoblin",value:function(){this._clickedDuring=!1,this.goblinEl.classList.remove("hidden")}},{key:"hideGoblin",value:function(){this._clickedDuring=!1,this.goblinEl.classList.add("hidden")}},{key:"hasGoblin",value:function(){return!this.goblinEl.classList.contains("hidden")}},{key:"reset",value:function(){this.hideGoblin()}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,a(i.key),i)}}function a(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var c=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onMiss=e,this.onHit=n,this.cells=[],this.interval=null,this._timer=null,this._activeCell=null,this._stopped=!0,this._lastIndex=null},(e=[{key:"init",value:function(t){this.el=t,this.el.style.setProperty("--grid-columns",4);for(var e=0;e<16;e++){var n=new o(this._cellClickHandler.bind(this));n.render(this.el),this.cells.push(n)}}},{key:"_cellClickHandler",value:function(t,e){e&&(this.cells[t].hideGoblin(),this.onHit&&this.onHit())}},{key:"start",value:function(){!1!==this._stopped&&(this._stopped=!1,this.spawn())}},{key:"spawn",value:function(){var t=this,e=this.cells.length;if(0!==e){var n,i=0;do{if(n=Math.floor(Math.random()*e),(i+=1)>20)break}while(this.cells[n].hasGoblin()||n===this._lastIndex);var r=this.cells[n];this._lastIndex=n,r.showGoblin();var o=setTimeout(function(){r.hasGoblin()&&(r.hideGoblin(),t.onMiss&&t.onMiss()),t._stopped||t.spawn()},1e3);this._timer=o}}},{key:"stop",value:function(){this._stopped=!0,this._timer&&(clearTimeout(this._timer),this._timer=null),this.cells.forEach(function(t){return t.hideGoblin()})}},{key:"reset",value:function(){this.stop(),this.cells.forEach(function(t){return t.reset()})}}])&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,d(i.key),i)}}function d(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var m=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.score=0,this.misses=0,this.scoreEl=null,this.missesEl=null},(e=[{key:"init",value:function(t,e){this.scoreEl=t,this.missesEl=e,this.render()}},{key:"render",value:function(){this.scoreEl&&(this.scoreEl.textContent=this.score),this.missesEl&&(this.missesEl.textContent=this.misses)}},{key:"incrementScore",value:function(){return this.score+=1,this.render(),this.score}},{key:"incrementMisses",value:function(){return this.misses+=1,this.render(),this.misses}},{key:"reset",value:function(){this.score=0,this.misses=0,this.render()}}])&&h(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const f=t+"assets/94e588e3ba9e1d729218.png";function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,b(i.key),i)}}function b(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}var p=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=e,this.scoreboard=new m,this.board=new c(this.onMiss.bind(this),this.onHit.bind(this)),this.rootEl=null,this.hammerEl=null,this._onMouseMove=this._onMouseMove.bind(this)},e=[{key:"init",value:function(){var t=this;this._render(),this.board.init(document.querySelector(".board")),this.scoreboard.init(document.querySelector(".score-el"),document.querySelector(".misses-el")),this.board.start(),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mousedown",function(){t.hammerEl&&t.hammerEl.classList.add("hit")}),document.addEventListener("mouseup",function(){t.hammerEl&&t.hammerEl.classList.remove("hit")})}},{key:"_render",value:function(){var t=this,e=document.createElement("div");e.classList.add("app"),e.innerHTML='\n      <div class="header">\n        <div class="title">Гоблины!</div>\n        <div class="controls">\n          <div class="score">Score: <span class="score-el">0</span></div>\n          <div class="misses" style="margin-left:12px;">Misses: <span class="misses-el">0</span></div>\n          <button class="button restart">Restart</button>\n        </div>\n      </div>\n      <div class="board"></div>\n      <div class="footer">Попробуйте поймать гоблинов — пропустите 5 и игра закончится.</div>\n    ',this.container.append(e),this.rootEl=e,this.rootEl.querySelector(".restart").addEventListener("click",function(){return t.restart()}),this.hammerEl=document.createElement("img"),this.hammerEl.src=f,this.hammerEl.alt="hammer",this.hammerEl.classList.add("hammer"),this.hammerEl.style.display="none",document.body.append(this.hammerEl),this.rootEl.addEventListener("mouseenter",function(){t.hammerEl.style.display="block"}),this.rootEl.addEventListener("mouseleave",function(){t.hammerEl.style.display="none"})}},{key:"_onMouseMove",value:function(t){this.hammerEl&&(this.hammerEl.style.left="".concat(t.clientX,"px"),this.hammerEl.style.top="".concat(t.clientY,"px"))}},{key:"onHit",value:function(){this.scoreboard.incrementScore()}},{key:"onMiss",value:function(){this.scoreboard.incrementMisses()>=5&&this.endGame()}},{key:"endGame",value:function(){var t=this;this.board.stop();var e=document.createElement("div");e.classList.add("overlay-gameover"),e.innerHTML='\n      <div class="popup">\n        <strong>Game Over!</strong>\n        <div>Score: <span class="score-el">'.concat(this.scoreboard.score,'</span></div>\n        <button class="button restart">Restart</button>\n      </div>\n    '),document.body.append(e),e.querySelector(".restart").addEventListener("click",function(){e.remove(),t.restart()})}},{key:"restart",value:function(){this.scoreboard.reset(),this.board.reset(),this.board.start()}}],e&&y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("app");new p(t).init()})})();